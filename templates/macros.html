{% macro unit_stats_tab_pane(prefix, stats, has_cc) %}
<div id="{{prefix}}-stat-info">
	<ul class="nav nav-pills mb-3" role="tablist">
		{% for type in UnitType %}
		<li class="nav-item">
			<a class="nav-link{% if loop.first %} active{% endif %}"
			   role="tab"
			   data-toggle="pill"
			   href="#{{prefix}}-tab-{{ type.name | lower }}">
				<h5>{{ type.name }}&nbsp;{{ jp_types[type] }}</h5>
			</a>
		</li>
		{% endfor %}
	</ul>
	<div class="tab-content">
		{% for type in UnitType %}
		<div class="tab-pane fade {% if loop.first %}show active{%endif%}"
			 id="{{prefix}}-tab-{{ type.name | lower }}"
			 role="tabpanel">
			<table class="table table-bordered table-hover table-condensed">
				<thead>
				<tr>
					<td>&nbsp;</td>
					<th scope="col" class="text-right">Max</th>
					<th scope="col" class="text-right">Base&nbsp;(Evo)</th>
					<th scope="col" class="text-right">Growth</th>
					<th scope="col" class="text-right">Fusion&nbsp;(UD)</th>
					{% if has_cc %}
					<th scope="col" class="text-right">CC&nbsp;Skill</th>
					{% endif %}
				</tr>
				</thead>
				<tbody>
				{% for stat in StatType %}
				<tr>
					{% set s = stats.of(type).of(stat) %}
					<th scope="row" class="text-right">
						{{ stat.name }}&nbsp;{{ jp_stats[stat] }}
					</th>
					<td class="text-right">{{ s.max }}</td>
					<td class="text-right">
						{{ s.initial + s.evo_bonus }}&nbsp;({{ s.evo_bonus }})
					</td>
					<td class="text-right">{{ s.growth }}</td>
					<td class="text-right">
						{{ s.compose + s.ud.max }}&nbsp;({{ s.ud.max }})
					</td>
					{% if has_cc %}
					<td class="text-right">{{ s.skill_master }}</td>
					{% endif %}
				</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>
		{% endfor %}
	</div>
</div>
{% endmacro %}

{% macro unit_link(unit, hidden, cd_root) %}
<a id="unit-{{unit.ID}}" href="{{cd_root}}/units/{{unit.ID}}.html" data-unit-name="{{unit.any_name}} ({{unit.element.name}})" class="list-group-item list-group-item-action" style="{% if hidden %} display: none {% endif %}">
	<img src="{{cd_root}}/images/units/{{unit.resource_id}}/c_thum.png" style="zoom: 0.5;"/>
	{{unit.any_name | title}} {{unit.rarity.stars}}
	<small class="badge badge-secondary">{{ unit.ID }}</small>
	{% for tag in unit.tags %}
	<small class="badge {{badge_tag[tag.kind]}}">{{tag.desc.short_label_name}}</small>
	{% endfor %}
</a>
{% endmacro %}

{% macro inner_unit_skill(skill, cd_root, type, req_lv, req_dv) %}
<div class="card">
	<div class="card-header font-weight-bold {% if req_lv %} bg-transparent {% endif %} ">
		<div class="row">
			<div class="col">
				{% if skill.skill_icon %}
				<img src="{{ cd_root }}/images/skills/{{ skill.skill_icon }}.png" style="zoom: 0.75">
				{% endif %}
			</div>
			<div class="col p-0 text-center">
				{% if req_lv %}
				<small class="font-weight-bold">Evolves at Skill lv&nbsp;{{ req_lv }}</small> <br/>
				{% endif %}
				{{ skill.jp_desc.name }}
				{% if req_dv %}
				<br/> <span class="badge badge-danger">Required DV: {{ req_dv }}</span>
				{% endif %}
			</div>
			<div class="col text-right">
				{%- if skill.max_lv -%}
				lv&nbsp;{{ skill.max_lv }}
				{%- endif -%}
			</div>
		</div>
	</div>
	<div class="card-body pt-3">
		<div class="row mb-3">
			<div class="col">
				{% if type %}
				<span class="badge badge-warning">
					{{ jp_types[type] }}&nbsp;{{ type.name }}
				</span>
				{% endif %}
				{# TODO Use contextual badges #}
				<span class="badge badge-secondary">{{ skill.type.name | title }}</span>
			</div>
			<div class="col text-right">
				{% for genre in skill.genres %}
				{# TODO Use contextual badges #}
				<span class="badge badge-primary">{{ genre.name | title }}</span>
				{% endfor %}
			</div>
		</div>
		<p class="card-text">{{ skill.jp_desc.full }}</p>
	</div>
</div>
{% endmacro %}

{% macro unit_skill(skill, cd_root, type=None, req_dv=0) %}
{% if skill.evo %}
<div class="mb-3">
	{{
	inner_unit_skill(skill, cd_root, type, req_lv=0, req_dv=req_dv)
	}}
	{{
	inner_unit_skill(skill.evo.to_skill, cd_root, type, req_lv=skill.evo.req_level, req_dv=req_dv)
	}}
</div>
{% else %}
<div class="mb-3">
	{{ inner_unit_skill(skill, cd_root, type, req_lv=0, req_dv=req_dv) }}
</div>
{% endif %}
{% endmacro %}
